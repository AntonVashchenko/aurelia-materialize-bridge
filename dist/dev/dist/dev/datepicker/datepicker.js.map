{"version":3,"sources":["datepicker/datepicker.js"],"names":["bindable","customAttribute","bindingMode","TaskQueue","inject","getLogger","getBooleanFromAttributeValue","DatePickerDefaultParser","fireEvent","MdDatePicker","Element","defaultBindingMode","twoWay","oneTime","element","taskQueue","defaultParser","calendarIcon","mdUnrenderValidateResults","results","renderer","result","valid","removeMessage","parentNode","removeValidationClasses","mdRenderValidateResults","hasAttribute","getAttribute","addMessage","addValidationClasses","find","x","log","parsers","push","onCalendarIconClick","bind","attached","selectMonths","selectYears","parseInt","classList","add","options","onClose","$","document","activeElement","blur","i18n","Object","assign","container","picker","pickadate","on","value","set","editable","e","keyCode","parseDate","val","updateValue","closeDatePicker","openDatePicker","showIcon","createElement","textContent","insertBefore","nextSibling","iconClass","setErrorTextAttribute","length","parser","canParse","parsedDate","parse","detached","remove","off","stop","undefined","selected","get","obj","event","stopPropagation","valueChanged","newValue","max","debug","showErrortextChanged","showErrortext","setAttribute"],"mappings":"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","file":"../../../datepicker/datepicker.js","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\nimport {bindingMode} from 'aurelia-binding';\nimport {TaskQueue} from 'aurelia-task-queue';\nimport {inject} from 'aurelia-dependency-injection';\nimport {getLogger} from 'aurelia-logging';\nimport {getBooleanFromAttributeValue} from '../common/attributes';\nimport {DatePickerDefaultParser} from './datepicker-default-parser';\nimport {fireEvent} from '../common/events';\n\n@inject(Element, TaskQueue, DatePickerDefaultParser)\n@customAttribute('md-datepicker')\nexport class MdDatePicker {\n  @bindable() container;\n  @bindable() translation;\n  @bindable({defaultBindingMode: bindingMode.twoWay}) value;\n  @bindable({defaultBindingMode: bindingMode.twoWay}) parsers = [];\n  @bindable({defaultBindingMode: bindingMode.oneTime}) selectMonths = true;\n  @bindable({defaultBindingMode: bindingMode.oneTime}) selectYears = 15;\n  @bindable({defaultBindingMode: bindingMode.oneTime}) options = {};\n  @bindable() showErrortext = true;\n  calendarIcon = null;\n\n  constructor(element, taskQueue, defaultParser) {\n    this.element = element;\n    this.log = getLogger('md-datepicker');\n    this.taskQueue = taskQueue;\n    this.parsers.push(defaultParser);\n    this.onCalendarIconClick = this.onCalendarIconClick.bind(this);\n  }\n\n  attached() {\n    this.element.mdUnrenderValidateResults = this.mdUnrenderValidateResults;\n    this.element.mdRenderValidateResults = this.mdRenderValidateResults;\n  }\n\n  bind() {\n    this.selectMonths = getBooleanFromAttributeValue(this.selectMonths);\n    this.selectYears = parseInt(this.selectYears, 10);\n    this.element.classList.add('date-picker');\n\n    let options = {\n      selectMonths: this.selectMonths,\n      selectYears: this.selectYears,\n      onClose: function() {\n        // see https://github.com/Dogfalo/materialize/issues/2067\n        // and: https://github.com/amsul/pickadate.js/issues/160\n        $(document.activeElement).blur();\n        // $(this.element).blur();\n      }\n    };\n    let i18n = {};\n    // let i18n = {\n    //   selectMonths: true, // Creates a dropdown to control month\n    //   selectYears: 15, // Creates a dropdown of 15 years to control year\n    //   monthsFull: [ 'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember' ],\n    //   monthsShort: [ 'Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez' ],\n    //   weekdaysFull: [ 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag' ],\n    //   weekdaysShort: [ 'So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa' ],\n    //   today: 'Heute',\n    //   clear: 'Löschen',\n    //   close: 'Schließen',\n    //   firstDay: 1,\n    //   format: 'dddd, dd. mmmm yyyy',\n    //   formatSubmit: 'yyyy/mm/dd'\n    // };\n    Object.assign(options, i18n);\n\n    if (this.options) {\n      Object.assign(options, this.options);\n      //merge callback methods if there is a hook in the advanced options\n      if (this.options.onClose) {\n        options.onClose = () => {\n          this.options.onClose();\n          $(document.activeElement).blur();\n        };\n      }\n    }\n    if (this.container) {\n      options.container = this.container;\n    }\n    this.picker = $(this.element).pickadate(options).pickadate('picker');\n    this.picker.on({\n      'close': this.onClose.bind(this)\n      // 'set': this.onSet.bind(this)\n    });\n\n    if (this.value) {\n      this.picker.set('select', this.value);\n    }\n    if (this.options && this.options.editable) {\n      $(this.element).on('keydown', (e)=> {\n        if (e.keyCode === 13 || e.keyCode === 9) {\n          if (this.parseDate($(this.element).val())) {\n            this.updateValue();\n            this.closeDatePicker();\n          } else {\n            this.openDatePicker();\n          }\n        } else {\n          this.value = null;\n        }\n      });\n    } else {\n      $(this.element).on('focusin', () => {\n        this.openDatePicker();\n      });\n    }\n    if (this.options.showIcon) {\n      this.element.classList.add('left');\n      this.calendarIcon = document.createElement('i');\n      this.calendarIcon.classList.add('right');\n      this.calendarIcon.classList.add('material-icons');\n      this.calendarIcon.textContent = 'today';\n      this.element.parentNode.insertBefore(this.calendarIcon, this.element.nextSibling);\n      $(this.calendarIcon).on('click', this.onCalendarIconClick);\n\n      options.iconClass = options.iconClass || 'std-icon-fixup';\n      this.calendarIcon.classList.add(options.iconClass);\n    }\n\n    this.setErrorTextAttribute();\n  }\n\n  parseDate(value) {\n    if (this.parsers && this.parsers.length && this.parsers.length > 0) {\n      for (const parser of this.parsers) {\n        if (parser.canParse(value)) {\n          const parsedDate = parser.parse(value);\n          if (parsedDate !== null) {\n            this.picker.set('select', parsedDate);\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n\n  detached() {\n    if (this.options.showIcon) {\n      this.element.classList.remove('left');\n      $(this.calendarIcon).off('click', this.onCalendarIconClick);\n      $(this.calendarIcon).remove();\n      this.calendarIcon = null;\n    }\n    if (this.picker) {\n      this.picker.stop();\n    }\n    this.element.mdUnrenderValidateResults = undefined;\n    this.element.mdRenderValidateResults = undefined;\n  }\n\n  openDatePicker() {\n    $(this.element).pickadate('open');\n  }\n\n  closeDatePicker() {\n    $(this.element).pickadate('close');\n  }\n\n  updateValue() {\n    let selected = this.picker.get('select');\n    this.value = selected ? selected.obj : null;\n  }\n\n  onClose() {\n    this.updateValue();\n    fireEvent(this.element, 'blur');\n  }\n\n  onCalendarIconClick(event) {\n    event.stopPropagation();\n    this.openDatePicker();\n  }\n\n  // onSet(value) {\n  //   //handle this ourselves since Dogfalo removed this functionality from the original plugin\n  //   if (this.options && this.options.closeOnSelect && value.select) {\n  //     this.value = value.select;\n  //     this.picker.close();\n  //   }\n  //   // this.value = new Date(value.select);\n  // }\n\n  valueChanged(newValue) {\n    if (this.options.max && newValue > this.options.max) {\n      this.value = this.options.max;\n    }\n    this.log.debug('selectedChanged', this.value);\n    // this.taskQueue.queueTask(() => {\n    this.picker.set('select', this.value);\n    // });\n  }\n\n  showErrortextChanged() {\n    this.setErrorTextAttribute();\n  }\n\n  setErrorTextAttribute() {\n    const element = this.element;\n    if (!element) return;\n    this.log.debug('showErrortextChanged: ' + this.showErrortext);\n    element.setAttribute('data-show-errortext', getBooleanFromAttributeValue(this.showErrortext));\n  }\n\n  mdUnrenderValidateResults = (results, renderer) => {\n    for(let result of results) {\n      if (!result.valid) {\n        renderer.removeMessage(this.element.parentNode, result);\n      }\n    }\n    renderer.removeValidationClasses(this.element);\n  };\n\n  mdRenderValidateResults = (results, renderer) => {\n    if (!(this.element.hasAttribute('data-show-errortext') && this.element.getAttribute('data-show-errortext') === 'false')) {\n      for(let result of results) {\n        if (!result.valid) {\n          renderer.addMessage(this.element.parentNode, result);\n        }\n      }\n    }\n    renderer.addValidationClasses(this.element, !results.find(x => !x.valid));\n  };\n}\n"]}