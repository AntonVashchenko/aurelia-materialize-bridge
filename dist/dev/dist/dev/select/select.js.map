{"version":3,"sources":["select/select.js"],"names":[],"mappings":"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","file":"select/select.js","sourceRoot":"/source/","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\r\nimport {BindingEngine} from 'aurelia-binding';\r\nimport {inject} from 'aurelia-dependency-injection';\r\nimport {TaskQueue} from 'aurelia-task-queue';\r\nimport * as LogManager from 'aurelia-logging';\r\nimport {fireEvent} from '../common/events';\r\nimport {getBooleanFromAttributeValue} from '../common/attributes';\r\nimport {DOM} from 'aurelia-pal';\r\n\r\n@inject(Element, LogManager, BindingEngine, TaskQueue)\r\n@customAttribute('md-select')\r\nexport class MdSelect {\r\n  @bindable() disabled = false;\r\n  @bindable() label = '';\r\n  @bindable() showErrortext = true;\r\n  _suspendUpdate = false;\r\n  subscriptions = [];\r\n  input = null;\r\n  dropdownMutationObserver = null;\r\n\r\n  constructor(element, logManager, bindingEngine, taskQueue) {\r\n    this.element = element;\r\n    this.taskQueue = taskQueue;\r\n    this.handleChangeFromViewModel = this.handleChangeFromViewModel.bind(this);\r\n    this.handleChangeFromNativeSelect = this.handleChangeFromNativeSelect.bind(this);\r\n    this.handleBlur = this.handleBlur.bind(this);\r\n    this.log = LogManager.getLogger('md-select');\r\n    this.bindingEngine = bindingEngine;\r\n  }\r\n\r\n  attached() {\r\n    this.taskQueue.queueTask(() => {\r\n      this.createMaterialSelect(false);\r\n\r\n      if (this.label) {\r\n        let wrapper = $(this.element).parent('.select-wrapper');\r\n        let div = $('<div class=\"input-field\"></div>');\r\n        let va = this.element.attributes.getNamedItem('validate');\r\n        if (va) {\r\n          div.attr(va.name, va.label);\r\n        }\r\n        wrapper.wrap(div);\r\n        $(`<label>${this.label}</label>`).insertAfter(wrapper);\r\n      }\r\n    });\r\n    this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'value').subscribe(this.handleChangeFromViewModel));\r\n    // this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'selectedOptions').subscribe(this.notifyBindingEngine.bind(this)));\r\n    // $(this.element).material_select(() => {\r\n    //   this.log.warn('materialize callback', $(this.element).val());\r\n    //   this.handleChangeFromNativeSelect();\r\n    // });\r\n\r\n    $(this.element).on('change', this.handleChangeFromNativeSelect);\r\n  }\r\n\r\n  detached() {\r\n    $(this.element).off('change', this.handleChangeFromNativeSelect);\r\n    this.observeVisibleDropdownContent(false);\r\n    this.dropdownMutationObserver = null;\r\n    $(this.element).material_select('destroy');\r\n    this.subscriptions.forEach(sub => sub.dispose());\r\n  }\r\n\r\n  refresh() {\r\n    this.taskQueue.queueTask(() => {\r\n      this.createMaterialSelect(true);\r\n    });\r\n  }\r\n\r\n  disabledChanged(newValue) {\r\n    this.toggleControl(newValue);\r\n  }\r\n\r\n  showErrortextChanged() {\r\n    this.setErrorTextAttribute();\r\n  }\r\n\r\n  setErrorTextAttribute() {\r\n    let input = this.element.parentElement.querySelector('input.select-dropdown');\r\n    if (!input) return;\r\n    this.log.debug('showErrortextChanged: ' + this.showErrortext);\r\n    input.setAttribute('data-show-errortext', getBooleanFromAttributeValue(this.showErrortext));\r\n  }\r\n\r\n  notifyBindingEngine() {\r\n    this.log.debug('selectedOptions changed', arguments);\r\n  }\r\n\r\n  handleChangeFromNativeSelect() {\r\n    if (!this._suspendUpdate) {\r\n      this.log.debug('handleChangeFromNativeSelect', this.element.value, $(this.element).val());\r\n      this._suspendUpdate = true;\r\n      fireEvent(this.element, 'change');\r\n      this._suspendUpdate = false;\r\n    }\r\n  }\r\n\r\n  handleChangeFromViewModel(newValue) {\r\n    this.log.debug('handleChangeFromViewModel', newValue, $(this.element).val());\r\n    if (!this._suspendUpdate) {\r\n      this.createMaterialSelect(false);\r\n    }\r\n  }\r\n\r\n  toggleControl(disable) {\r\n    let $wrapper = $(this.element).parent('.select-wrapper');\r\n    if ($wrapper.length > 0) {\r\n      if (disable) {\r\n        $('.caret', $wrapper).addClass('disabled');\r\n        $('input.select-dropdown', $wrapper).attr('disabled', 'disabled');\r\n        $wrapper.attr('disabled', 'disabled');\r\n      } else {\r\n        $('.caret', $wrapper).removeClass('disabled');\r\n        $('input.select-dropdown', $wrapper).attr('disabled', null);\r\n        $wrapper.attr('disabled', null);\r\n        $('.select-dropdown', $wrapper).dropdown({'hover': false, 'closeOnClick': false});\r\n      }\r\n    }\r\n  }\r\n\r\n  createMaterialSelect(destroy) {\r\n    this.observeVisibleDropdownContent(false);\r\n    if (destroy) {\r\n      $(this.element).material_select('destroy');\r\n    }\r\n    $(this.element).material_select();\r\n    this.toggleControl(this.disabled);\r\n    this.observeVisibleDropdownContent(true);\r\n    this.setErrorTextAttribute();\r\n  }\r\n\r\n  observeVisibleDropdownContent(attach) {\r\n    if (attach) {\r\n      if (!this.dropdownMutationObserver) {\r\n        this.dropdownMutationObserver = DOM.createMutationObserver(mutations => {\r\n          let isHidden = false;\r\n          for (let mutation of mutations) {\r\n            if (window.getComputedStyle(mutation.target).getPropertyValue('display') === 'none') {\r\n              isHidden = true;\r\n            }\r\n          }\r\n          if (isHidden) {\r\n            this.dropdownMutationObserver.takeRecords();\r\n            this.handleBlur();\r\n          }\r\n        });\r\n      }\r\n      this.dropdownMutationObserver.observe(this.element.parentElement.querySelector('.dropdown-content'), {\r\n        attributes: true,\r\n        attributeFilter: ['style']\r\n      });\r\n    } else {\r\n      if (this.dropdownMutationObserver) {\r\n        this.dropdownMutationObserver.disconnect();\r\n        this.dropdownMutationObserver.takeRecords();\r\n      }\r\n    }\r\n  }\r\n\r\n  //\r\n  // Firefox sometimes fire blur several times in a row\r\n  // observable at http://localhost:3000/#/samples/select/\r\n  // when enable 'Disable Functionality', open that list and\r\n  // then open 'Basic use' list.\r\n  // Chrome - ok\r\n  // IE 11 - ok\r\n  // Edge ?\r\n  //\r\n  _taskqueueRunning = false;\r\n\r\n  handleBlur() {\r\n    if (this._taskqueueRunning) return;\r\n    this._taskqueueRunning = true;\r\n    this.taskQueue.queueTask(() => {\r\n      this.log.debug('fire blur event');\r\n      fireEvent(this.element, 'blur');\r\n      this._taskqueueRunning = false;\r\n    });\r\n  }\r\n}\r\n"]}