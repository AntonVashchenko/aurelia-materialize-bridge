{"version":3,"sources":["select/select.js"],"names":[],"mappings":"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","file":"select/select.js","sourceRoot":"/source/","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\nimport {BindingEngine} from 'aurelia-binding';\nimport {inject} from 'aurelia-dependency-injection';\nimport {TaskQueue} from 'aurelia-task-queue';\nimport * as LogManager from 'aurelia-logging';\nimport {fireEvent} from '../common/events';\n\n@inject(Element, LogManager, BindingEngine, TaskQueue)\n@customAttribute('md-select')\nexport class MdSelect {\n  @bindable() disabled = false;\n  @bindable() label = '';\n  _suspendUpdate = false;\n  subscriptions = [];\n  input = null;\n\n  constructor(element, logManager, bindingEngine, taskQueue) {\n    this.element = element;\n    this.taskQueue = taskQueue;\n    this.handleChangeFromViewModel = this.handleChangeFromViewModel.bind(this);\n    this.handleChangeFromNativeSelect = this.handleChangeFromNativeSelect.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.log = LogManager.getLogger('md-select');\n    this.bindingEngine = bindingEngine;\n  }\n\n  attached() {\n    this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'value').subscribe(this.handleChangeFromViewModel));\n    // this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'selectedOptions').subscribe(this.notifyBindingEngine.bind(this)));\n    // $(this.element).material_select(() => {\n    //   this.log.warn('materialize callback', $(this.element).val());\n    //   this.handleChangeFromNativeSelect();\n    // });\n    this.createMaterialSelect(false);\n\n    if (this.label) {\n      let wrapper = $(this.element).parent('.select-wrapper');\n      let div = $('<div class=\"input-field\"></div>');\n      let va = this.element.attributes.getNamedItem('validate');\n      if (va) {\n        div.attr(va.name, va.label);\n      }\n      wrapper.wrap(div);\n      $(`<label>${this.label}</label>`).insertAfter(wrapper);\n    }\n    $(this.element).on('change', this.handleChangeFromNativeSelect);\n  }\n\n  detached() {\n    $(this.element).off('change', this.handleChangeFromNativeSelect);\n    this.attachBlur(false);\n    $(this.element).material_select('destroy');\n    this.subscriptions.forEach(sub => sub.dispose());\n  }\n\n  refresh() {\n    this.taskQueue.queueTask(() => {\n      this.createMaterialSelect(true);\n    });\n  }\n\n  handleBlur() {\n    this.log.debug('handleBlur called');\n\n    // problem: if this comes from an actual \"blur\" event, the event is fired too early\n    //          if this comes from a \"change\" event, the timing is correct\n\n    // take 1\n    // setTimeout(() => {\n    //   fireEvent(this.element, 'blur');\n    // }, 200);\n\n    // TaskQueue doesn't change anything because the \"change\" event is fired after\n    // the queue has been processed\n\n    // take 2\n    // if (!this._blurHandled) {\n    //   this.taskQueue.queueTask(() => {\n    //     fireEvent(this.element, 'blur');\n    //     this.log.debug('blur event fired');\n    //     this._blurHandled = false;\n    //   });\n    //   this._blurHandled = true;\n    // }\n\n    // take 3\n    fireEvent(this.element, 'blur');\n  }\n\n  disabledChanged(newValue) {\n    this.toggleControl(newValue);\n  }\n\n  notifyBindingEngine() {\n    this.log.debug('selectedOptions changed', arguments);\n  }\n\n  handleChangeFromNativeSelect() {\n    if (!this._suspendUpdate) {\n      this.log.debug('handleChangeFromNativeSelect', this.element.value, $(this.element).val());\n      this._suspendUpdate = true;\n      fireEvent(this.element, 'change');\n      this._suspendUpdate = false;\n    }\n  }\n\n  handleChangeFromViewModel(newValue) {\n    this.log.debug('handleChangeFromViewModel', newValue, $(this.element).val());\n    if (!this._suspendUpdate) {\n      this.createMaterialSelect(false);\n    }\n  }\n\n  toggleControl(disable) {\n    let $wrapper = $(this.element).parent('.select-wrapper');\n    if ($wrapper.length > 0) {\n      if (disable) {\n        $('.caret', $wrapper).addClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', 'disabled');\n        $wrapper.attr('disabled', 'disabled');\n      } else {\n        $('.caret', $wrapper).removeClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', null);\n        $wrapper.attr('disabled', null);\n        $('.select-dropdown', $wrapper).dropdown({'hover': false, 'closeOnClick': false});\n      }\n    }\n  }\n\n  attachBlur(attach) {\n    if (attach) {\n      let $wrapper = $(this.element).parent('.select-wrapper');\n      if ($wrapper.length > 0) {\n        this.input = $('input.select-dropdown:first', $wrapper);\n        if (this.input) {\n          this.input.on('blur', this.handleBlur);\n        }\n      }\n      // this.element.addEventListener('change', this.handleBlur);\n    } else {\n      if (this.input) {\n        this.input.off('blur', this.handleBlur);\n        this.input = null;\n      }\n      // this.element.removeEventListener('change', this.handleBlur);\n    }\n  }\n\n  createMaterialSelect(destroy) {\n    this.attachBlur(false);\n    if (destroy) {\n      $(this.element).material_select('destroy');\n    }\n    $(this.element).material_select();\n    this.toggleControl(this.disabled);\n    this.attachBlur(true);\n  }\n}\n"]}