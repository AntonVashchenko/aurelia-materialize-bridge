{"version":3,"sources":["select/select.js"],"names":["bindable","customAttribute","BindingEngine","inject","TaskQueue","getLogger","fireEvent","getBooleanFromAttributeValue","DOM","MdSelect","Element","element","bindingEngine","taskQueue","_suspendUpdate","subscriptions","input","dropdownMutationObserver","optionsMutationObserver","_taskqueueRunning","handleChangeFromViewModel","bind","handleChangeFromNativeSelect","handleBlur","log","attached","queueTask","createMaterialSelect","wrapper","$","parent","label","siblings","length","div","va","attributes","getNamedItem","attr","name","wrap","insertAfter","push","propertyObserver","subscribe","on","detached","off","observeVisibleDropdownContent","observeOptions","children","remove","data","material_select","forEach","sub","dispose","refresh","labelChanged","newValue","updateLabel","$label","text","disabledChanged","toggleControl","showErrortextChanged","setErrorTextAttribute","parentElement","querySelector","debug","showErrortext","setAttribute","notifyBindingEngine","arguments","value","val","disable","$wrapper","addClass","removeClass","dropdown","destroy","disabled","attach","createMutationObserver","isHidden","mutations","mutation","window","getComputedStyle","target","getPropertyValue","takeRecords","observe","attributeFilter","disconnect","enableOptionObserver","characterData","subtree"],"mappings":"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","file":"../../../select/select.js","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\nimport {BindingEngine} from 'aurelia-binding';\nimport {inject} from 'aurelia-dependency-injection';\nimport {TaskQueue} from 'aurelia-task-queue';\nimport {getLogger} from 'aurelia-logging';\nimport {fireEvent} from '../common/events';\nimport {getBooleanFromAttributeValue} from '../common/attributes';\nimport {DOM} from 'aurelia-pal';\n\n@inject(Element, BindingEngine, TaskQueue)\n@customAttribute('md-select')\nexport class MdSelect {\n  @bindable() disabled = false;\n  @bindable() enableOptionObserver = false;\n  @bindable() label = '';\n  @bindable() showErrortext = true;\n  _suspendUpdate = false;\n  subscriptions = [];\n  input = null;\n  dropdownMutationObserver = null;\n  optionsMutationObserver = null;\n\n  constructor(element, bindingEngine, taskQueue) {\n    this.element = element;\n    this.taskQueue = taskQueue;\n    this.handleChangeFromViewModel = this.handleChangeFromViewModel.bind(this);\n    this.handleChangeFromNativeSelect = this.handleChangeFromNativeSelect.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.log = getLogger('md-select');\n    this.bindingEngine = bindingEngine;\n  }\n\n  attached() {\n    this.taskQueue.queueTask(() => {\n      this.createMaterialSelect(false);\n\n      let wrapper = $(this.element).parent('.select-wrapper');\n      if (this.label && !wrapper.siblings(\"label\").length) {\n        let div = $('<div class=\"input-field\"></div>');\n        let va = this.element.attributes.getNamedItem('validate');\n        if (va) {\n          div.attr(va.name, va.label);\n        }\n        wrapper.wrap(div);\n        $(`<label class=\"md-select-label\">${this.label}</label>`).insertAfter(wrapper);\n      }\n    });\n    this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'value').subscribe(this.handleChangeFromViewModel));\n\n    $(this.element).on('change', this.handleChangeFromNativeSelect);\n  }\n\n  detached() {\n    $(this.element).off('change', this.handleChangeFromNativeSelect);\n    this.observeVisibleDropdownContent(false);\n    this.observeOptions(false);\n    this.dropdownMutationObserver = null;\n    $(this.element).parent().children(\".md-input-validation\").remove();\n    $(this.element).parent().children(`ul#select-options-${$(this.element).data('select-id')}`).remove();\n    $(this.element).material_select('destroy');\n    this.subscriptions.forEach(sub => sub.dispose());\n  }\n\n  refresh() {\n    this.taskQueue.queueTask(() => {\n      this.createMaterialSelect(true);\n    });\n  }\n\n  labelChanged(newValue) {\n    this.updateLabel();\n  }\n\n  updateLabel() {\n    if (this.label) {\n      const $label = $(this.element).parent('.select-wrapper').siblings('.md-select-label');\n      $label.text(this.label);\n    }\n  }\n\n  disabledChanged(newValue) {\n    this.toggleControl(newValue);\n  }\n\n  showErrortextChanged() {\n    this.setErrorTextAttribute();\n  }\n\n  setErrorTextAttribute() {\n    let input = this.element.parentElement.querySelector('input.select-dropdown');\n    if (!input) return;\n    this.log.debug('showErrortextChanged: ' + this.showErrortext);\n    input.setAttribute('data-show-errortext', getBooleanFromAttributeValue(this.showErrortext));\n  }\n\n  notifyBindingEngine() {\n    this.log.debug('selectedOptions changed', arguments);\n  }\n\n  handleChangeFromNativeSelect() {\n    if (!this._suspendUpdate) {\n      this.log.debug('handleChangeFromNativeSelect', this.element.value, $(this.element).val());\n      this._suspendUpdate = true;\n      fireEvent(this.element, 'change');\n      this._suspendUpdate = false;\n    }\n  }\n\n  handleChangeFromViewModel(newValue) {\n    this.log.debug('handleChangeFromViewModel', newValue, $(this.element).val());\n    if (!this._suspendUpdate) {\n      this.createMaterialSelect(false);\n    }\n  }\n\n  toggleControl(disable) {\n    let $wrapper = $(this.element).parent('.select-wrapper');\n    if ($wrapper.length > 0) {\n      if (disable) {\n        $('.caret', $wrapper).addClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', 'disabled');\n        $wrapper.attr('disabled', 'disabled');\n      } else {\n        $('.caret', $wrapper).removeClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', null);\n        $wrapper.attr('disabled', null);\n        $('.select-dropdown', $wrapper).dropdown({'hover': false, 'closeOnClick': false});\n      }\n    }\n  }\n\n  createMaterialSelect(destroy) {\n    this.observeVisibleDropdownContent(false);\n    this.observeOptions(false);\n    if (destroy) {\n      $(this.element).material_select('destroy');\n    }\n    $(this.element).material_select();\n    this.toggleControl(this.disabled);\n    this.observeVisibleDropdownContent(true);\n    this.observeOptions(true);\n    this.setErrorTextAttribute();\n  }\n\n  observeVisibleDropdownContent(attach) {\n    if (attach) {\n      if (!this.dropdownMutationObserver) {\n        this.dropdownMutationObserver = DOM.createMutationObserver(mutations => {\n          let isHidden = false;\n          for (let mutation of mutations) {\n            if (window.getComputedStyle(mutation.target).getPropertyValue('display') === 'none') {\n              isHidden = true;\n            }\n          }\n          if (isHidden) {\n            this.dropdownMutationObserver.takeRecords();\n            this.handleBlur();\n          }\n        });\n      }\n      this.dropdownMutationObserver.observe(this.element.parentElement.querySelector('.dropdown-content'), {\n        attributes: true,\n        attributeFilter: ['style']\n      });\n    } else {\n      if (this.dropdownMutationObserver) {\n        this.dropdownMutationObserver.disconnect();\n        this.dropdownMutationObserver.takeRecords();\n      }\n    }\n  }\n\n  observeOptions(attach) {\n    if (getBooleanFromAttributeValue(this.enableOptionObserver)) {\n      if (attach) {\n        if (!this.optionsMutationObserver) {\n          this.optionsMutationObserver = DOM.createMutationObserver(mutations => {\n            // this.log.debug('observeOptions', mutations);\n            this.refresh();\n          });\n        }\n        this.optionsMutationObserver.observe(this.element, {\n          // childList: true,\n          characterData: true,\n          subtree: true\n        });\n      } else {\n        if (this.optionsMutationObserver) {\n          this.optionsMutationObserver.disconnect();\n          this.optionsMutationObserver.takeRecords();\n        }\n      }\n    }\n  }\n\n  //\n  // Firefox sometimes fire blur several times in a row\n  // observable at http://localhost:3000/#/samples/select/\n  // when enable 'Disable Functionality', open that list and\n  // then open 'Basic use' list.\n  // Chrome - ok\n  // IE 11 - ok\n  // Edge ?\n  //\n  _taskqueueRunning = false;\n\n  handleBlur() {\n    if (this._taskqueueRunning) return;\n    this._taskqueueRunning = true;\n    this.taskQueue.queueTask(() => {\n      this.log.debug('fire blur event');\n      fireEvent(this.element, 'blur');\n      this._taskqueueRunning = false;\n    });\n  }\n}\n"]}